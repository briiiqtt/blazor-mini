@page "/visitComment"
@rendermode InteractiveServer
@inject NavigationManager _navigationManager
@inject IJSRuntime JsRuntime
@using ProjectR.DTOs

<PageTitle>ê¹€ë²”ìˆ˜</PageTitle>

<article class="page sans">
  <header>
    <div class="page-header-icon undefined"><span class="icon">ğŸ‘¨â€ğŸ’»</span></div>
    <h1 class="page-title">ë°©ëª…ë¡</h1>
    <p class="page-description"></p>
  </header>
  <div class="page-body" style="margin=left: auto; max-width: 50vw;">
    <div style="background-color: #292929; padding: 10px;">
      <div>
        ì‘ì„±ì: <input type="text" placeholder="ì‘ì„±ìëª…" @bind="writerName" class="comment-writer" /><br />
        <div class="comment-content-box">
          <textarea placeholder="ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." class="comment-content" @bind="content" />
          <button class="comment-button" @onclick="Write">ê¸€ ë‚¨ê¸°ê¸°</button>
        </div>
      </div>
      <div>
        @if (CommentList is not null)
        {
          @foreach (var comment in CommentList)
          {
            <div class="comment">
              <span>@comment.Content</span>
              <span style="font-size: 0.85rem;">@comment.WriterName | @comment.CreatedAt</span>
            </div>
          }
        }
      </div>
    </div>
  </div>
</article>

@code {

  CommentModel cm = new CommentModel();

  string writerName = "";
  string content = "";
  List<Comment>? CommentList;

  protected override void OnInitialized()
  {
    CommentList = cm.Read();
  }

  async void Write()
  {
    if (writerName.Trim() == "")
    {
      await JsRuntime.InvokeVoidAsync("alert", "ì‘ì„±ì ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }
    if (content.Trim() == "")
    {
      await JsRuntime.InvokeVoidAsync("alert", "ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }
    int affectedRows = cm.Write(writerName, content);
    if (affectedRows == 1)
    {
      CommentList = cm.Read();
    }
    else
    {
      await JsRuntime.InvokeVoidAsync("alert", "error");
    }
  }

}